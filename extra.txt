if submit:
            # ... (previous code for dates and validation) ...

            # Dictionary to store counts
            article_counts = {"TY": 0, "LY": 0, "LLY": 0}
            
            art_files = {"TY": u_ty, "LY": u_ly, "LLY": u_lly}
            for label, fobj in art_files.items():
                fobj.seek(0)
                # Read file
                df = pd.read_excel(fobj, header=None) if fobj.name.endswith('xlsx') else pd.read_csv(fobj, header=None)
                
                # --- COUNT ARTICLES IN COL B (Index 1) ---
                if df.shape[1] >= 2:
                    # Count non-null unique articles in Column B
                    count = df.iloc[:, 1].dropna().nunique()
                    article_counts[label] = count
                
                # Capture SQL Tuple from TY file (Col F / Index 5)
                if label == "TY" and df.shape[1] >= 6:
                    st.session_state.sql_article_tuple = str(df.iloc[0, 5])
                
                # Save raw sheets to workbook
                mgr.add_raw_sheet(f"{label}_Items_{new_tab_name}"[:31], df)

            # --- CREATE TAB & WRITE DATA ---
            mgr.create_promo_tab(st.session_state.selected_base, new_tab_name)
            m = config['mappings']
            
            # Write Dates
            mgr.write_to_cell(new_tab_name, m['ty_qualify_dates'], ty_display)
            mgr.write_to_cell(new_tab_name, m['ly_qualify_dates'], ly_display)
            if current_phase == "LIFT" and 'lly_qualify_dates' in m:
                mgr.write_to_cell(new_tab_name, m['lly_qualify_dates'], lly_display)

            # --- WRITE ARTICLE COUNTS ---
            # Map the counts to the cells defined in JSON
            if 'ty_article_count' in m:
                mgr.write_to_cell(new_tab_name, m['ty_article_count'], article_counts["TY"])
            if 'ly_article_count' in m:
                mgr.write_to_cell(new_tab_name, m['ly_article_count'], article_counts["LY"])
            if 'lly_article_count' in m:
                mgr.write_to_cell(new_tab_name, m['lly_article_count'], article_counts["LLY"])

            st.session_state.step = 4
            st.rerun()