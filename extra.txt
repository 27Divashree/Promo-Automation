def render_step_5(self, mgr, config):
        render_persistent_header()
        st.header("Step 5: Paste SQL Output")
        st.caption("Paste your output rows below (Include Headers + Data):")
        sql_output_str = st.text_area("SQL Output")
        
        if st.button("Complete Analysis", type="primary"):
            if sql_output_str:
                # 1. Split the text area into separate lines
                raw_lines = [line for line in sql_output_str.strip().split('\n') if line.strip()]
                
                if len(raw_lines) >= 2:
                    # Smart split: Use tabs if they exist (standard SQL copy), else split by spaces
                    sep = '\t' if '\t' in raw_lines[0] else None 
                    
                    headers = [item.strip() for item in raw_lines[0].split(sep) if item.strip()]
                    data_row = [item.strip() for item in raw_lines[1].split(sep) if item.strip()]
                    
                    # 2. Write the Data (Row 2) vertically to the Main Tab
                    mgr.write_vertical_array(st.session_state.current_tab, config['mappings']['sql_output_start'], data_row)
                    
                    # 3. Safely Create the SQL Tab
                    clean_tab_name = re.sub(r'[\\/*?:\[\]]', '', st.session_state.current_tab)
                    sql_tab_name = f"sql_{clean_tab_name}"[:31]
                    
                    if sql_tab_name not in mgr.wb.sheetnames:
                        mgr.wb.create_sheet(sql_tab_name)
                        
                    sql_sheet = mgr.wb[sql_tab_name]
                    
                    # 4. Write Headers (Row 1) and Data (Row 2) horizontally (A-I)
                    for col_idx, header_val in enumerate(headers, start=1):
                        sql_sheet.cell(row=1, column=col_idx, value=header_val)
                        
                    for col_idx, data_val in enumerate(data_row, start=1):
                        sql_sheet.cell(row=2, column=col_idx, value=data_val)
                        
                    # 5. Write SQL code line-by-line down column K
                    saved_sql = st.session_state.get('final_sql', '-- No SQL found')
                    sql_lines = [line for line in saved_sql.split('\n')]
                    mgr.write_vertical_array(sql_tab_name, 'K1', sql_lines)

                    st.success(f"Analysis complete for {st.session_state.current_tab}! SQL & Data saved to {sql_tab_name}.")
                    st.session_state.step = 6 
                    st.rerun()
                else:
                    st.warning("Please paste at least two rows (Headers and Data).")
            else:
                st.warning("Please paste the SQL output first.")